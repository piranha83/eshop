"use strict";(self.webpackChunkeshop=self.webpackChunkeshop||[]).push([[254],{179:(re,B,i)=>{i.r(B),i.d(B,{CatalogModule:()=>oe});var u=i(6895),d=i(7054),C=i(7579),N=i(4482),R=i(5403),S=i(8421),Y=i(5032);function y(o){return(0,N.e)((r,e)=>{(0,S.Xf)(o).subscribe((0,R.x)(e,()=>e.complete(),Y.Z)),!e.closed&&r.subscribe(e)})}var t=i(1571),h=i(6019),z=i(2340),k=i(4964);function b(o,r){if(1&o&&t._UZ(0,"img",7),2&o){const e=t.oxw();t.s9C("src",e._img,t.LSH)}}const Q=[[["app-raiting"]],[["app-button"]]],j=function(o){return["/catalog",o]},X=["<app-raiting>","<app-button>"];let w=(()=>{class o{constructor(e){this.priceService=e,this._product=null,this._img=null,this.AddToCart=new t.vpe}set product(e){this._product=e,null!=e&&(this._img=`${z.N.url}img/${e?.img}`)}ngOnInit(){}onRate(e){this._product&&(this._product.rate=e)}onClick(){this._product&&this.AddToCart.emit(this._product)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(k.N))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-productcard"]],inputs:{product:"product"},outputs:{AddToCart:"AddToCart"},features:[t._Bn([])],ngContentSelectors:X,decls:18,vars:19,consts:[[1,"app-productcard"],["data-testid","product-img","alt","",3,"src",4,"ngIf"],["data-testid","product-url",3,"routerLink"],["data-testid","price",1,"line"],["data-testid","discount"],["data-testid","description"],["data-testid","discount-price"],["data-testid","product-img","alt","",3,"src"]],template:function(e,n){1&e&&(t.F$t(Q),t.TgZ(0,"div",0),t.YNc(1,b,1,1,"img",1),t.TgZ(2,"a",2),t._uU(3),t.qZA(),t.TgZ(4,"span",3),t._uU(5),t.ALo(6,"currency"),t.qZA(),t.TgZ(7,"span",4),t._uU(8),t.ALo(9,"percent"),t.qZA(),t.TgZ(10,"p",5),t._uU(11),t.qZA(),t.TgZ(12,"h3",6),t._uU(13),t.ALo(14,"currency"),t.qZA(),t.Hsn(15),t.Hsn(16,1),t._UZ(17,"div"),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",null==n._product?null:n._product.img),t.xp6(1),t.Q6J("routerLink",t.VKq(17,j,null==n._product?null:n._product.id)),t.xp6(1),t.Oqu(null==n._product?null:n._product.name),t.xp6(2),t.Oqu(t.Dn7(6,7,null==n._product?null:n._product.price,"RUB","symbol-narrow")),t.xp6(3),t.Oqu(t.lcZ(9,11,null==n._product?null:n._product.discount)),t.xp6(3),t.Oqu(null==n._product?null:n._product.description),t.xp6(2),t.hij(" ",t.Dn7(14,13,n.priceService.discountPrice(n._product),"RUB","symbol-narrow")," "))},directives:[u.O5,d.yS],pipes:[u.H9,u.Zx],encapsulation:2}),o})();function q(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"span",1),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw().onRateClick(s)}),t._uU(1," star_rate "),t.qZA()}if(2&o){const e=r.$implicit,n=t.oxw();t.Q6J("ngClass",n.rating(e))}}const K=function(){return[0,1,2,3,4]};let G=(()=>{class o{constructor(){this.Rate=new t.vpe}ngOnInit(){}rating(e){return e<=(this.rate||0)?"active":""}onRateClick(e){this.Rate.emit(e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-raiting"]],inputs:{rate:"rate"},outputs:{Rate:"Rate"},decls:2,vars:2,consts:[["class","material-icons app-raiting",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"material-icons","app-raiting",3,"ngClass","click"]],template:function(e,n){1&e&&(t.TgZ(0,"div"),t.YNc(1,q,2,1,"span",0),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",t.DdM(1,K)))},directives:[u.sg,u.mk],encapsulation:2}),o})(),V=(()=>{class o{constructor(e,n,a){this.route=e,this.router=n,this.catalogService=a,this.destroy$=new C.x,this.catalogService.get(+this.route.snapshot.params.id).pipe(y(this.destroy$)).subscribe(l=>{null!=l?this.product=l:this.router.navigate(["404"])})}ngOnInit(){}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}onAddToCart(e){}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.gz),t.Y36(d.F0),t.Y36(h.a))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-productpage"]],features:[t._Bn([])],decls:2,vars:2,consts:[[3,"product","AddToCart"],[3,"rate"]],template:function(e,n){1&e&&(t.TgZ(0,"app-productcard",0),t.NdJ("AddToCart",function(s){return n.onAddToCart(s)}),t._UZ(1,"app-raiting",1),t.qZA()),2&e&&(t.Q6J("product",n.product),t.xp6(1),t.Q6J("rate",null==n.product?null:n.product.rate))},directives:[w,G],encapsulation:2}),o})();var W=i(8372),tt=i(1884),c=i(1831);const _=(0,c.ZF)("catalog"),et=(0,c.P1)(_,o=>o.products),ot=(0,c.P1)(_,o=>o.filter),nt=(0,c.P1)(_,o=>o.loading),rt=(0,c.P1)(_,o=>o.products?.length!=o.total-1),A=(0,c.PH)("[Catalog] enter",(0,c.Ky)()),$=(0,c.PH)("[Catalog Api] loaded",(0,c.Ky)()),O=(0,c.PH)("[Catalog Api] error",(0,c.Ky)()),P={products:null,loading:!1,done:!1,filter:{sort:"Default",term:"",toggle:"ShowAll",page:1,size:3},total:0},at=(0,c.Lq)(P,(0,c.on)(A,(o,{filter:r})=>({...o,loading:!0,filter:r})),(0,c.on)($,(o,{products:r})=>({...o,loading:!1,done:0==r.data.length,products:o.filter.page>1?[...o.products||[],...r?.data||[]]:r.data,total:r.total})),(0,c.on)(O,o=>({...o,loading:!1}))),J=(0,c.PH)("[Cart] add product",(0,c.Ky)()),M=(0,c.PH)("[Cart] remove product",(0,c.Ky)()),E=(0,c.PH)("[Cart] clear product"),D=(0,c.ZF)("cart"),ct=(0,c.P1)(D,o=>o.items),it=(0,c.P1)(D,o=>o.items.map(r=>r.count).reduce((r,e)=>r+e,0));var st=i(8306),U=i(5577),ut=i(1144),g=i(576),lt=i(3268);const pt=["addListener","removeListener"],dt=["addEventListener","removeEventListener"],gt=["on","off"];function x(o,r,e,n){if((0,g.m)(e)&&(n=e,e=void 0),n)return x(o,r,e).pipe((0,lt.Z)(n));const[a,s]=function ft(o){return(0,g.m)(o.addEventListener)&&(0,g.m)(o.removeEventListener)}(o)?dt.map(l=>p=>o[l](r,p,e)):function mt(o){return(0,g.m)(o.addListener)&&(0,g.m)(o.removeListener)}(o)?pt.map(L(o,r)):function Ct(o){return(0,g.m)(o.on)&&(0,g.m)(o.off)}(o)?gt.map(L(o,r)):[];if(!a&&(0,ut.z)(o))return(0,U.z)(l=>x(l,r,e))((0,S.Xf)(o));if(!a)throw new TypeError("Invalid event target");return new st.y(l=>{const p=(...f)=>l.next(1<f.length?f:f[0]);return a(p),()=>s(p)})}function L(o,r){return e=>n=>o[e](r,n)}function ht(o){switch((o||"").toLocaleLowerCase()){case"instock":return"InStock";case"hasdiscount":return"HasDiscount";default:return"ShowAll"}}let _t=(()=>{class o{constructor(e){this.host=e,this.click$=x(this.host.nativeElement,"click")}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(t.SBq))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})();var vt=i(5568);const Tt=["*"];let F=(()=>{class o extends _t{constructor(e){super(e),this.host=e,this.isActive=!1,this.isDisabled=!1,this._color="default",this._size="default"}set color(e){this._color=e}set size(e){this._size=e}get style(){return{"font-size":this._size,"line-height.px":"small"==this._size?15:18}}get class(){return{primary:"primary"==this._color,accent:"accent"==this._color,success:"success"==this._color,warning:"warning"==this._color,active:this.isActive}}ngOnChanges(e){e.color&&console.log(e.color)}onClick(){this.isActive=!0}onMouseOut(){this.isActive=!1}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(t.SBq))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-button"]],inputs:{isActive:"isActive",isDisabled:"isDisabled",color:"color",size:"size",data:"data"},features:[t.qOj,t.TTD],ngContentSelectors:Tt,decls:2,vars:3,consts:[["type","button",1,"card","card-small",3,"ngClass","ngStyle","click","mouseout"]],template:function(e,n){1&e&&(t.F$t(),t.TgZ(0,"button",0),t.NdJ("click",function(){return n.onClick()})("mouseout",function(){return n.onMouseOut()}),t.Hsn(1),t.qZA()),2&e&&(t.Q6J("ngClass",n.class)("ngStyle",n.style),t.uIk("disabled",n.isDisabled?"":null))},directives:[u.mk,u.PC],encapsulation:2}),o})(),yt=(()=>{class o{constructor(e){this.el=e,this.clickOut=new t.vpe,console.log("PopupDirective")}onLeave(e){this.el.nativeElement.contains(e.target)||this.clickOut.emit(e)}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(t.SBq))},o.\u0275dir=t.lG2({type:o,selectors:[["","over",""]],hostBindings:function(e,n){1&e&&t.NdJ("click",function(s){return n.onLeave(s)},!1,t.evT)},outputs:{clickOut:"clickOut"},exportAs:["over"]}),o})();function At(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"li")(1,"app-button",7),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).onRemoveFromCart(s)}),t._uU(2,"X"),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.ALo(5,"currency"),t.ALo(6,"currency"),t.qZA()()}if(2&o){const e=r.$implicit,n=t.oxw(2);t.xp6(4),t.HOy(" ",null==e.product?null:e.product.name," ",t.Dn7(5,4,e.product.price,"RUB","symbol-narrow")," x ",e.count," \u0448\u0442. = ",t.Dn7(6,8,n.priceService.getPrice(e),"RUB","symbol-narrow")," \u0441\u043e \u0441\u043a\u0438\u0434\u043a\u043e\u0439 ")}}function xt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("clickOut",function(a){return t.CHM(e),t.oxw().hideCart(a)}),t.TgZ(1,"a",3),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClearCart()}),t._uU(2,"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443"),t.qZA(),t.TgZ(3,"ul"),t.YNc(4,At,7,12,"ng-template",4),t.TgZ(5,"li",5),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"li",5),t._uU(9),t.ALo(10,"currency"),t.qZA()(),t.TgZ(11,"div")(12,"a",3),t.NdJ("click",function(){return t.CHM(e),t.oxw().onToggleCart()}),t._uU(13,"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443"),t.qZA(),t.TgZ(14,"app-button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCheckout()}),t._uU(15,"\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437"),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(4),t.Q6J("ngForOf",e.products),t.xp6(2),t.hij(" \u0421\u043a\u0438\u0434\u043a\u0430 ",t.Dn7(7,3,e.priceService.getTotalDiscount(e.products),"RUB","symbol-narrow")," "),t.xp6(3),t.hij(" \u041a \u043e\u043f\u043b\u0430\u0442\u0435 ",t.Dn7(10,7,e.priceService.getTotalPrice(e.products),"RUB","symbol-narrow")," ")}}let Ft=(()=>{class o{constructor(e){this.priceService=e,this.products=[],this.total=0,this.removeFromCart=new t.vpe,this.clearCart=new t.vpe,this.checkout=new t.vpe,this.showCart=!1}hideCart(e){"BUTTON"!=e.target.tagName.toUpperCase()&&-1==e.target.outerText.indexOf("\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0435")&&(this.showCart=!1)}onToggleCart(){this.products?.length&&(this.showCart=!this.showCart)}onCheckout(){this.checkout.emit(),this.showCart=!1}onRemoveFromCart(e){this.removeFromCart.emit(e.product),this.showCart=!1}onClearCart(){this.clearCart.emit(),this.showCart=!1}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(k.N))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-cart"]],inputs:{products:"products",total:"total"},outputs:{removeFromCart:"removeFromCart",clearCart:"clearCart",checkout:"checkout"},features:[t._Bn([])],decls:3,vars:2,consts:[["size","small","color","warning",1,"buy",3,"click"],["class","button cart","over","",3,"clickOut",4,"ngIf"],["over","",1,"button","cart",3,"clickOut"],[3,"click"],["ngFor","",3,"ngForOf"],[1,"footer"],["color","accent",3,"click"],["size","small",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"app-button",0),t.NdJ("click",function(){return n.onToggleCart()}),t._uU(1),t.qZA(),t.YNc(2,xt,16,11,"div",1)),2&e&&(t.xp6(1),t.hij("\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0435 ",n.total,""),t.xp6(1),t.Q6J("ngIf",n.showCart))},directives:[F,u.O5,yt,u.sg],pipes:[u.H9],encapsulation:2}),o})();var Zt=i(9718),Bt=i(6451),St=i(8505);const kt=[[["",8,"toggle"]]],wt=[".toggle"];let $t=(()=>{class o{constructor(){this.sort="Default",this.changed=new t.vpe,this.sortChanged=new t.vpe,this.destroy$=new C.x}ngAfterContentInit(){const e=this.toggles.map(n=>n.click$.pipe((0,Zt.h)(n)));(0,Bt.T)(...e).pipe((0,St.b)(n=>{this.toggles.map(a=>a.isDisabled=!1),n.isDisabled=!0,this.onChanged(n.data)})).pipe(y(this.destroy$)).subscribe()}ngOnInit(){}onChanged(e){this.changed.emit(e)}onSortChanged(e){this.sortChanged.emit(e.value)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-toggle"]],contentQueries:function(e,n,a){if(1&e&&t.Suo(a,F,4),2&e){let s;t.iGM(s=t.CRH())&&(n.toggles=s)}},inputs:{sort:"sort"},outputs:{changed:"changed",sortChanged:"sortChanged"},ngContentSelectors:wt,decls:10,vars:1,consts:[[1,"app-toggle"],[1,"button",3,"value","change"],["value","Default"],["value","PriceAsc"],["value","PriceDesc"]],template:function(e,n){1&e&&(t.F$t(kt),t.TgZ(0,"div",0),t.Hsn(1),t._uU(2," \u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c: "),t.TgZ(3,"select",1),t.NdJ("change",function(s){return n.onSortChanged(s.target)}),t.TgZ(4,"option",2),t._uU(5,"\u041b\u0443\u0447\u0448\u0435\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435"),t.qZA(),t.TgZ(6,"option",3),t._uU(7,"C\u043d\u0430\u0447\u0430\u043b\u0430 \u0434\u0435\u0448\u0435\u0432\u043b\u0435"),t.qZA(),t.TgZ(8,"option",4),t._uU(9,"C\u043d\u0430\u0447\u0430\u043b\u0430 \u0434\u043e\u0440\u043e\u0436\u0435"),t.qZA()()()),2&e&&(t.xp6(3),t.Q6J("value",n.sort))},encapsulation:2}),o})();var Ot=i(1135),v=i(4004),Pt=i(3900),Jt=i(457),Mt=i(9300);let H=(()=>{class o{constructor(){this._state={favorites:[]},this.state$=new Ot.X(this._state),this.products$=this.state$.pipe((0,v.U)(e=>e.favorites)),this.totalProducts$=this.products$.pipe((0,v.U)(e=>e.length)),console.log("Favorite")}update(){this.state$.next({...this._state})}addProduct(e){this._state={...this._state,favorites:[...this._state.favorites,{product:e}]},this.update()}removeProduct(e){this._state={...this._state,favorites:this._state.favorites.filter(n=>n.product.id!=e.id)},this.update()}isFavoriteProduct(e){return this._state.favorites.some(n=>n.product.id==e.id)}toggleFavoriteProduct(e){this.isFavoriteProduct(e)?this.removeProduct(e):this.addProduct(e)}getProduct(e){return this.products$.pipe((0,Pt.w)(n=>(0,Jt.D)(n)),(0,Mt.h)(n=>n.product.id==e.id),(0,v.U)(n=>n.product))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})(),Et=(()=>{class o{constructor(e){this.favoriteService=e,this.destroy$=new C.x}ngOnInit(){}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}onToggleFavoriteClick(){this.favoriteService.toggleFavoriteProduct(this.product)}get isFavorite(){return this.favoriteService.isFavoriteProduct(this.product)?"active":""}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(H))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-favorite"]],inputs:{product:"product"},decls:2,vars:1,consts:[[1,"material-icons","app-raiting",3,"ngClass","click"]],template:function(e,n){1&e&&(t.TgZ(0,"span",0),t.NdJ("click",function(){return n.onToggleFavoriteClick()}),t._uU(1," favorite "),t.qZA()),2&e&&t.Q6J("ngClass",n.isFavorite)},directives:[u.mk],encapsulation:2}),o})();function Dt(o,r){1&o&&(t.ynx(0),t._uU(1," \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430... "),t.BQk())}function Ut(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"app-productcard",10),t._UZ(1,"app-favorite",10),t.TgZ(2,"app-button",11),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).onAddToCart(s)}),t._uU(3,"\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0443"),t.qZA()()}if(2&o){const e=r.$implicit;t.Q6J("product",e),t.xp6(1),t.Q6J("product",e),t.xp6(1),t.Q6J("isDisabled",!e.inStock)}}function Lt(o,r){1&o&&(t.ynx(0),t._uU(1," \u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e. "),t.BQk())}function Ht(o,r){if(1&o&&t.YNc(0,Lt,2,0,"ng-container",0),2&o){const e=t.oxw().ngIf;t.Q6J("ngIf",0===e.length)}}function It(o,r){1&o&&t.YNc(0,Ht,1,1,"ng-template")}function Nt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"app-button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().ngIf;return t.oxw().onLoad(a)}),t._uU(1,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0435\u0449\u0435"),t.qZA()}}function Rt(o,r){if(1&o){const e=t.EpF();t.ynx(0),t.YNc(1,Dt,2,0,"ng-container",0),t.ALo(2,"async"),t.TgZ(3,"app-cart",1),t.NdJ("removeFromCart",function(a){return t.CHM(e),t.oxw().onRemoveFromCart(a)})("clearCart",function(){return t.CHM(e),t.oxw().onClearCart()})("checkout",function(){return t.CHM(e),t.oxw().onCheckout()}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA(),t.TgZ(6,"app-toggle",2),t.NdJ("changed",function(a){const l=t.CHM(e).ngIf;return t.oxw().onToggleChanged(l,a)})("sortChanged",function(a){const l=t.CHM(e).ngIf;return t.oxw().onSortChanged(l,a)}),t.TgZ(7,"app-button",3),t._uU(8,"\xab\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435\xbb"),t.qZA(),t.TgZ(9,"app-button",4),t._uU(10,"\xab\u0412 \u043d\u0430\u043b\u0438\u0447\u0438\u0438\xbb"),t.qZA(),t.TgZ(11,"app-button",5),t._uU(12,"\xab\u0421\u043e \u0441\u043a\u0438\u0434\u043a\u043e\u0439\xbb"),t.qZA()(),t.TgZ(13,"input",6),t.NdJ("keyup",function(a){const l=t.CHM(e).ngIf;return t.oxw().onSearch(l,a)}),t.qZA(),t.TgZ(14,"div",7),t.YNc(15,Ut,4,3,"ng-template",8),t.ALo(16,"async"),t.YNc(17,It,1,0,null,0),t.ALo(18,"async"),t.qZA(),t.TgZ(19,"div",7),t.YNc(20,Nt,2,0,"app-button",9),t.ALo(21,"async"),t.qZA(),t.BQk()}if(2&o){const e=r.ngIf,n=t.oxw();t.xp6(1),t.Q6J("ngIf",t.lcZ(2,7,n.loading$)),t.xp6(2),t.Q6J("products",t.lcZ(4,9,n.inCart$))("total",t.lcZ(5,11,n.total$)),t.xp6(3),t.Q6J("sort",e.sort),t.xp6(9),t.Q6J("ngForOf",t.lcZ(16,13,n.products$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(18,15,n.products$)),t.xp6(3),t.Q6J("ngIf",t.lcZ(21,17,n.next$))}}let Yt=(()=>{class o{constructor(e,n,a,s,l){this.route=e,this.router=n,this.catalogService=a,this.cartService=s,this.store=l,this.products$=this.store.pipe((0,c.Ys)(et)),this.filter$=this.store.pipe((0,c.Ys)(ot)),this.loading$=this.store.pipe((0,c.Ys)(nt)),this.next$=this.store.pipe((0,c.Ys)(rt)),this.inCart$=this.store.pipe((0,c.Ys)(ct)),this.total$=this.store.pipe((0,c.Ys)(it)),this.term$=new C.x,this.destroy$=new C.x,this.route.queryParams.subscribe(p=>{let f={...P,toggle:ht(p.toggle),sort:p.sort||"Default"};this.loadCatalog(f.filter),this.term$.pipe((0,W.b)(3e3)).pipe((0,tt.x)()).pipe(y(this.destroy$)).subscribe(ne=>this.loadCatalog(ne))})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}onSearch(e,n){this.term$.next({...e,page:1,term:n.target.value})}onAddToCart(e){this.store.dispatch(J({product:e}))}onRemoveFromCart(e){this.store.dispatch(M({product:e}))}onClearCart(){this.store.dispatch(E())}onCheckout(){this.cartService.checkout(),this.router.navigate(["order"])}onToggleChanged(e,n){this.loadCatalog({...e,page:1,toggle:n})}onSortChanged(e,n){this.loadCatalog({...e,page:1,sort:n})}onLoad(e){this.loadCatalog({...e,page:e.page+1})}onRate(e,n){n.rate=e}loadCatalog(e){this.store.dispatch(A({filter:e}))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.gz),t.Y36(d.F0),t.Y36(h.a),t.Y36(vt.N),t.Y36(c.yh))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-catalog"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"products","total","removeFromCart","clearCart","checkout"],[3,"sort","changed","sortChanged"],["data","ShowAll",1,"toggle"],["data","InStock",1,"toggle"],["data","HasDiscount",1,"toggle"],["placeholder","\u043f\u043e\u0438\u0441\u043a",1,"search","button",3,"keyup"],[1,"center"],["ngFor","",3,"ngForOf"],["color","primary",3,"click",4,"ngIf"],[3,"product"],[3,"isDisabled","click"],["color","primary",3,"click"]],template:function(e,n){1&e&&(t.YNc(0,Rt,22,19,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,n.filter$))},directives:[u.O5,Ft,$t,F,u.sg,w,Et],pipes:[u.Ov],encapsulation:2,changeDetection:0}),o})();const zt=[{path:"",component:(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-catalogpage"]],features:[t._Bn([])],decls:1,vars:0,template:function(e,n){1&e&&t._UZ(0,"app-catalog")},directives:[Yt],encapsulation:2}),o})()},{path:":id",component:V}];let bt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.ez,d.Bz.forChild(zt)],d.Bz]}),o})(),Qt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.ez]]}),o})();var I=i(4466);let jt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[d.Bz,u.ez,Qt,I.m]]}),o})();class m{constructor(){this.items=m.load()}static load(){const r=localStorage.getItem("cart");let e=[];return r&&(e=JSON.parse(r)),e}static save(r){localStorage.setItem("cart",JSON.stringify(r))}}const Xt={items:m.load()},qt=(0,c.Lq)(Xt,(0,c.on)(J,(o,{product:r})=>{let e={items:o.items.filter(s=>s.product.id!=r.id)},n=o.items.findIndex(s=>s.product.id===r.id),a=n>-1?o.items[n]?.count??0:0;return e.items.splice(n,0,{count:++a,product:r}),m.save(e.items),e}),(0,c.on)(M,(o,{product:r})=>{let e={items:o.items.filter(n=>n.product.id!=r.id)};return m.save(e.items),e}),(0,c.on)(E,()=>{let o={items:[]};return m.save(o.items),o}));var T=i(493),Kt=i(262),Gt=i(9646);let Vt=(()=>{class o{constructor(e,n){this.action$=e,this.catalogService=n,this.loadProducts$=(0,T.GW)(()=>this.action$.pipe((0,T.l4)(A),(0,U.z)(a=>this.catalogService.find(a.filter).pipe((0,v.U)(s=>$({products:s}),(0,Kt.K)(s=>(0,Gt.of)(O({error:s}))))))))}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(T.eX),t.LFG(h.a))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac}),o})(),Z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.ez]]}),o})(),Wt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[Z,u.ez]]}),o})(),te=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[H],imports:[[u.ez]]}),o})(),ee=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.ez,Z]]}),o})(),oe=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[h.a],imports:[[u.ez,bt,Wt,I.m,ee,jt,Z,te,c.Aw.forFeature("catalog",at),c.Aw.forFeature("cart",qt),T.sQ.forFeature([Vt])]]}),o})()}}]);