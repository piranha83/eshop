"use strict";(self.webpackChunkeshop=self.webpackChunkeshop||[]).push([[280],{5280:(se,B,s)=>{s.r(B),s.d(B,{CatalogModule:()=>ie});var u=s(6895),d=s(566),h=s(7579),w=s(4482),k=s(5403),$=s(8421),Q=s(5032);function A(e){return(0,w.e)((r,o)=>{(0,$.Xf)(e).subscribe((0,k.x)(o,()=>o.complete(),Q.Z)),!o.closed&&r.subscribe(o)})}var t=s(1571),v=s(6019),b=s(2340),O=s(4964);function j(e,r){if(1&e&&t._UZ(0,"img",7),2&e){const o=t.oxw();t.s9C("src",o._img,t.LSH)}}const X=[[["app-raiting"]],[["app-button"]]],q=function(e){return["/catalog",e]},K=["<app-raiting>","<app-button>"];let P=(()=>{class e{constructor(o){this.priceService=o,this._product=null,this._img=null,this.AddToCart=new t.vpe}set product(o){this._product=o,null!=o&&(this._img=`${b.N.url}img/${o?.img}`)}ngOnInit(){}onRate(o){this._product&&(this._product.rate=o)}onClick(){this._product&&this.AddToCart.emit(this._product)}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(O.N))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-productcard"]],inputs:{product:"product"},outputs:{AddToCart:"AddToCart"},features:[t._Bn([])],ngContentSelectors:K,decls:18,vars:19,consts:[[1,"app-productcard"],["data-testid","product-img","alt","",3,"src",4,"ngIf"],["data-testid","product-url",3,"routerLink"],["data-testid","price",1,"line"],["data-testid","discount"],["data-testid","description"],["data-testid","discount-price"],["data-testid","product-img","alt","",3,"src"]],template:function(o,n){1&o&&(t.F$t(X),t.TgZ(0,"div",0),t.YNc(1,j,1,1,"img",1),t.TgZ(2,"a",2),t._uU(3),t.qZA(),t.TgZ(4,"span",3),t._uU(5),t.ALo(6,"currency"),t.qZA(),t.TgZ(7,"span",4),t._uU(8),t.ALo(9,"percent"),t.qZA(),t.TgZ(10,"p",5),t._uU(11),t.qZA(),t.TgZ(12,"h3",6),t._uU(13),t.ALo(14,"currency"),t.qZA(),t.Hsn(15),t.Hsn(16,1),t._UZ(17,"div"),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngIf",null==n._product?null:n._product.img),t.xp6(1),t.Q6J("routerLink",t.VKq(17,q,null==n._product?null:n._product.id)),t.xp6(1),t.Oqu(null==n._product?null:n._product.name),t.xp6(2),t.Oqu(t.Dn7(6,7,null==n._product?null:n._product.price,"RUB","symbol-narrow")),t.xp6(3),t.Oqu(t.lcZ(9,11,null==n._product?null:n._product.discount)),t.xp6(3),t.Oqu(null==n._product?null:n._product.description),t.xp6(2),t.hij(" ",t.Dn7(14,13,n.priceService.discountPrice(n._product),"RUB","symbol-narrow")," "))},directives:[u.O5,d.yS],pipes:[u.H9,u.Zx],encapsulation:2}),e})();function G(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"span",1),t.NdJ("click",function(){const c=t.CHM(o).$implicit;return t.oxw().onRateClick(c)}),t._uU(1," star_rate "),t.qZA()}if(2&e){const o=r.$implicit,n=t.oxw();t.Q6J("ngClass",n.rating(o))}}const V=function(){return[0,1,2,3,4]};let W=(()=>{class e{constructor(){this.Rate=new t.vpe}ngOnInit(){}rating(o){return o<=(this.rate||0)?"active":""}onRateClick(o){this.Rate.emit(o)}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-raiting"]],inputs:{rate:"rate"},outputs:{Rate:"Rate"},decls:2,vars:2,consts:[["class","material-icons app-raiting",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"material-icons","app-raiting",3,"ngClass","click"]],template:function(o,n){1&o&&(t.TgZ(0,"div"),t.YNc(1,G,2,1,"span",0),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngForOf",t.DdM(1,V)))},directives:[u.sg,u.mk],encapsulation:2}),e})(),tt=(()=>{class e{constructor(o,n,a){this.route=o,this.router=n,this.catalogService=a,this.destroy$=new h.x,this.catalogService.get(+this.route.snapshot.params.id).pipe(A(this.destroy$)).subscribe(l=>{null!=l?this.product=l:this.router.navigate(["404"])})}ngOnInit(){}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}onAddToCart(o){}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(d.gz),t.Y36(d.F0),t.Y36(v.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-productpage"]],features:[t._Bn([])],decls:2,vars:2,consts:[[3,"product","AddToCart"],[3,"rate"]],template:function(o,n){1&o&&(t.TgZ(0,"app-productcard",0),t.NdJ("AddToCart",function(c){return n.onAddToCart(c)}),t._UZ(1,"app-raiting",1),t.qZA()),2&o&&(t.Q6J("product",n.product),t.xp6(1),t.Q6J("rate",null==n.product?null:n.product.rate))},directives:[P,W],encapsulation:2}),e})();var et=s(4408);const nt=new(s(640).v)(et.o);var at=s(1884),i=s(1831);const T=(0,i.ZF)("catalog"),ct=(0,i.P1)(T,e=>e.products),it=(0,i.P1)(T,e=>e.filter),st=(0,i.P1)(T,e=>e.loading),ut=(0,i.P1)(T,e=>e.products?.length!=e.total),x=(0,i.PH)("[Catalog] enter",(0,i.Ky)()),J=(0,i.PH)("[Catalog Api] loaded",(0,i.Ky)()),M=(0,i.PH)("[Catalog Api] error",(0,i.Ky)()),E={products:null,loading:!1,done:!1,filter:{sort:"Default",term:"",toggle:"ShowAll",page:1,size:3},total:0},lt=(0,i.Lq)(E,(0,i.on)(x,(e,{filter:r})=>({...e,loading:!0,filter:r})),(0,i.on)(J,(e,{products:r})=>({...e,loading:!1,done:0==r.data.length,products:e.filter.page>1?[...e.products||[],...r?.data||[]]:r.data,total:r.total})),(0,i.on)(M,e=>({...e,loading:!1}))),U=(0,i.PH)("[Cart] add product",(0,i.Ky)()),D=(0,i.PH)("[Cart] remove product",(0,i.Ky)()),L=(0,i.PH)("[Cart] clear product"),I=(0,i.ZF)("cart"),pt=(0,i.P1)(I,e=>e.items),dt=(0,i.P1)(I,e=>e.items.map(r=>r.count).reduce((r,o)=>r+o,0));var gt=s(8306),H=s(5577),mt=s(1144),m=s(576),Ct=s(3268);const ft=["addListener","removeListener"],ht=["addEventListener","removeEventListener"],_t=["on","off"];function F(e,r,o,n){if((0,m.m)(o)&&(n=o,o=void 0),n)return F(e,r,o).pipe((0,Ct.Z)(n));const[a,c]=function yt(e){return(0,m.m)(e.addEventListener)&&(0,m.m)(e.removeEventListener)}(e)?ht.map(l=>p=>e[l](r,p,o)):function vt(e){return(0,m.m)(e.addListener)&&(0,m.m)(e.removeListener)}(e)?ft.map(N(e,r)):function Tt(e){return(0,m.m)(e.on)&&(0,m.m)(e.off)}(e)?_t.map(N(e,r)):[];if(!a&&(0,mt.z)(e))return(0,H.z)(l=>F(l,r,o))((0,$.Xf)(e));if(!a)throw new TypeError("Invalid event target");return new gt.y(l=>{const p=(...C)=>l.next(1<C.length?C:C[0]);return a(p),()=>c(p)})}function N(e,r){return o=>n=>e[o](r,n)}function At(e){switch((e||"").toLocaleLowerCase()){case"instock":return"InStock";case"hasdiscount":return"HasDiscount";default:return"ShowAll"}}let xt=(()=>{class e{constructor(o){this.host=o,this.click$=F(this.host.nativeElement,"click")}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(t.SBq))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();var Ft=s(5568);const Zt=["*"];let Z=(()=>{class e extends xt{constructor(o){super(o),this.host=o,this.isActive=!1,this.isDisabled=!1,this._color="default",this._size="default"}set color(o){this._color=o}set size(o){this._size=o}get style(){return{"font-size":this._size,"line-height.px":"small"==this._size?15:18}}get class(){return{primary:"primary"==this._color,accent:"accent"==this._color,success:"success"==this._color,warning:"warning"==this._color,active:this.isActive}}ngOnChanges(o){o.color&&console.log(o.color)}onClick(){this.isActive=!0}onMouseOut(){this.isActive=!1}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(t.SBq))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-button"]],inputs:{isActive:"isActive",isDisabled:"isDisabled",color:"color",size:"size",data:"data"},features:[t.qOj,t.TTD],ngContentSelectors:Zt,decls:2,vars:3,consts:[["type","button",1,"card","card-small",3,"ngClass","ngStyle","click","mouseout"]],template:function(o,n){1&o&&(t.F$t(),t.TgZ(0,"button",0),t.NdJ("click",function(){return n.onClick()})("mouseout",function(){return n.onMouseOut()}),t.Hsn(1),t.qZA()),2&o&&(t.Q6J("ngClass",n.class)("ngStyle",n.style),t.uIk("disabled",n.isDisabled?"":null))},directives:[u.mk,u.PC],encapsulation:2}),e})(),St=(()=>{class e{constructor(o){this.el=o,this.clickOut=new t.vpe,console.log("PopupDirective")}onLeave(o){this.el.nativeElement.contains(o.target)||this.clickOut.emit(o)}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(t.SBq))},e.\u0275dir=t.lG2({type:e,selectors:[["","over",""]],hostBindings:function(o,n){1&o&&t.NdJ("click",function(c){return n.onLeave(c)},!1,t.evT)},outputs:{clickOut:"clickOut"},exportAs:["over"]}),e})();function Bt(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"li")(1,"app-button",7),t.NdJ("click",function(){const c=t.CHM(o).$implicit;return t.oxw(2).onRemoveFromCart(c)}),t._uU(2,"X"),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.ALo(5,"currency"),t.ALo(6,"currency"),t.qZA()()}if(2&e){const o=r.$implicit,n=t.oxw(2);t.xp6(4),t.HOy(" ",null==o.product?null:o.product.name," ",t.Dn7(5,4,o.product.price,"RUB","symbol-narrow")," x ",o.count," \u0448\u0442. = ",t.Dn7(6,8,n.priceService.getPrice(o),"RUB","symbol-narrow")," \u0441\u043e \u0441\u043a\u0438\u0434\u043a\u043e\u0439 ")}}function wt(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"div",2),t.NdJ("clickOut",function(a){return t.CHM(o),t.oxw().hideCart(a)}),t.TgZ(1,"a",3),t.NdJ("click",function(){return t.CHM(o),t.oxw().onClearCart()}),t._uU(2,"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443"),t.qZA(),t.TgZ(3,"ul"),t.YNc(4,Bt,7,12,"ng-template",4),t.TgZ(5,"li",5),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"li",5),t._uU(9),t.ALo(10,"currency"),t.qZA()(),t.TgZ(11,"div")(12,"a",3),t.NdJ("click",function(){return t.CHM(o),t.oxw().onToggleCart()}),t._uU(13,"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u043a\u043e\u0440\u0437\u0438\u043d\u0443"),t.qZA(),t.TgZ(14,"app-button",6),t.NdJ("click",function(){return t.CHM(o),t.oxw().onCheckout()}),t._uU(15,"\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437"),t.qZA()()()}if(2&e){const o=t.oxw();t.xp6(4),t.Q6J("ngForOf",o.products),t.xp6(2),t.hij(" \u0421\u043a\u0438\u0434\u043a\u0430 ",t.Dn7(7,3,o.priceService.getTotalDiscount(o.products),"RUB","symbol-narrow")," "),t.xp6(3),t.hij(" \u041a \u043e\u043f\u043b\u0430\u0442\u0435 ",t.Dn7(10,7,o.priceService.getTotalPrice(o.products),"RUB","symbol-narrow")," ")}}let kt=(()=>{class e{constructor(o){this.priceService=o,this.products=[],this.total=0,this.removeFromCart=new t.vpe,this.clearCart=new t.vpe,this.checkout=new t.vpe,this.showCart=!1}hideCart(o){"BUTTON"!=o.target.tagName.toUpperCase()&&-1==o.target.outerText.indexOf("\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0435")&&(this.showCart=!1)}onToggleCart(){this.products?.length&&(this.showCart=!this.showCart)}onCheckout(){this.checkout.emit(),this.showCart=!1}onRemoveFromCart(o){this.removeFromCart.emit(o.product),this.showCart=!1}onClearCart(){this.clearCart.emit(),this.showCart=!1}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(O.N))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-cart"]],inputs:{products:"products",total:"total"},outputs:{removeFromCart:"removeFromCart",clearCart:"clearCart",checkout:"checkout"},features:[t._Bn([])],decls:3,vars:2,consts:[["size","small","color","warning",1,"buy",3,"click"],["class","button cart","over","",3,"clickOut",4,"ngIf"],["over","",1,"button","cart",3,"clickOut"],[3,"click"],["ngFor","",3,"ngForOf"],[1,"footer"],["color","accent",3,"click"],["size","small",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"app-button",0),t.NdJ("click",function(){return n.onToggleCart()}),t._uU(1),t.qZA(),t.YNc(2,wt,16,11,"div",1)),2&o&&(t.xp6(1),t.hij("\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0435 ",n.total,""),t.xp6(1),t.Q6J("ngIf",n.showCart))},directives:[Z,u.O5,St,u.sg],pipes:[u.H9],encapsulation:2}),e})();var _=s(4004),Ot=s(6451),Pt=s(8505);const Jt=[[["",8,"toggle"]]],Mt=[".toggle"];let Et=(()=>{class e{constructor(){this.sort="Default",this.changed=new t.vpe,this.sortChanged=new t.vpe,this.destroy$=new h.x}ngAfterContentInit(){const o=this.toggles.map(n=>n.click$.pipe(function $t(e){return(0,_.U)(()=>e)}(n)));(0,Ot.T)(...o).pipe((0,Pt.b)(n=>{this.toggles.map(a=>a.isDisabled=!1),n.isDisabled=!0,this.onChanged(n.data)})).pipe(A(this.destroy$)).subscribe()}ngOnInit(){}onChanged(o){this.changed.emit(o)}onSortChanged(o){this.sortChanged.emit(o.value)}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-toggle"]],contentQueries:function(o,n,a){if(1&o&&t.Suo(a,Z,4),2&o){let c;t.iGM(c=t.CRH())&&(n.toggles=c)}},inputs:{sort:"sort"},outputs:{changed:"changed",sortChanged:"sortChanged"},ngContentSelectors:Mt,decls:10,vars:1,consts:[[1,"app-toggle"],[1,"button",3,"value","change"],["value","Default"],["value","PriceAsc"],["value","PriceDesc"]],template:function(o,n){1&o&&(t.F$t(Jt),t.TgZ(0,"div",0),t.Hsn(1),t._uU(2," \u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c: "),t.TgZ(3,"select",1),t.NdJ("change",function(c){return n.onSortChanged(c.target)}),t.TgZ(4,"option",2),t._uU(5,"\u041b\u0443\u0447\u0448\u0435\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435"),t.qZA(),t.TgZ(6,"option",3),t._uU(7,"C\u043d\u0430\u0447\u0430\u043b\u0430 \u0434\u0435\u0448\u0435\u0432\u043b\u0435"),t.qZA(),t.TgZ(8,"option",4),t._uU(9,"C\u043d\u0430\u0447\u0430\u043b\u0430 \u0434\u043e\u0440\u043e\u0436\u0435"),t.qZA()()()),2&o&&(t.xp6(3),t.Q6J("value",n.sort))},encapsulation:2}),e})();var Ut=s(1135),Dt=s(3900),Lt=s(457),It=s(9300);let R=(()=>{class e{constructor(){this._state={favorites:[]},this.state$=new Ut.X(this._state),this.products$=this.state$.pipe((0,_.U)(o=>o.favorites)),this.totalProducts$=this.products$.pipe((0,_.U)(o=>o.length)),console.log("Favorite")}update(){this.state$.next({...this._state})}addProduct(o){this._state={...this._state,favorites:[...this._state.favorites,{product:o}]},this.update()}removeProduct(o){this._state={...this._state,favorites:this._state.favorites.filter(n=>n.product.id!=o.id)},this.update()}isFavoriteProduct(o){return this._state.favorites.some(n=>n.product.id==o.id)}toggleFavoriteProduct(o){this.isFavoriteProduct(o)?this.removeProduct(o):this.addProduct(o)}getProduct(o){return this.products$.pipe((0,Dt.w)(n=>(0,Lt.D)(n)),(0,It.h)(n=>n.product.id==o.id),(0,_.U)(n=>n.product))}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),Ht=(()=>{class e{constructor(o){this.favoriteService=o,this.destroy$=new h.x}ngOnInit(){}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}onToggleFavoriteClick(){this.favoriteService.toggleFavoriteProduct(this.product)}get isFavorite(){return this.favoriteService.isFavoriteProduct(this.product)?"active":""}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(R))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-favorite"]],inputs:{product:"product"},decls:2,vars:1,consts:[[1,"material-icons","app-raiting",3,"ngClass","click"]],template:function(o,n){1&o&&(t.TgZ(0,"span",0),t.NdJ("click",function(){return n.onToggleFavoriteClick()}),t._uU(1," favorite "),t.qZA()),2&o&&t.Q6J("ngClass",n.isFavorite)},directives:[u.mk],encapsulation:2}),e})();function Nt(e,r){1&e&&(t.ynx(0),t._uU(1," \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430... "),t.BQk())}function Rt(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"app-productcard",10),t._UZ(1,"app-favorite",10),t.TgZ(2,"app-button",11),t.NdJ("click",function(){const c=t.CHM(o).$implicit;return t.oxw(2).onAddToCart(c)}),t._uU(3,"\u0412 \u043a\u043e\u0440\u0437\u0438\u043d\u0443"),t.qZA()()}if(2&e){const o=r.$implicit;t.Q6J("product",o),t.xp6(1),t.Q6J("product",o),t.xp6(1),t.Q6J("isDisabled",!o.inStock)}}function Yt(e,r){1&e&&(t.ynx(0),t._uU(1," \u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e. "),t.BQk())}function zt(e,r){if(1&e&&t.YNc(0,Yt,2,0,"ng-container",0),2&e){const o=t.oxw().ngIf;t.Q6J("ngIf",0===o.length)}}function Qt(e,r){1&e&&t.YNc(0,zt,1,1,"ng-template")}function bt(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"app-button",12),t.NdJ("click",function(){t.CHM(o);const a=t.oxw().ngIf;return t.oxw().onLoad(a)}),t._uU(1,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0435\u0449\u0435"),t.qZA()}}function jt(e,r){if(1&e){const o=t.EpF();t.ynx(0),t.YNc(1,Nt,2,0,"ng-container",0),t.ALo(2,"async"),t.TgZ(3,"app-cart",1),t.NdJ("removeFromCart",function(a){return t.CHM(o),t.oxw().onRemoveFromCart(a)})("clearCart",function(){return t.CHM(o),t.oxw().onClearCart()})("checkout",function(){return t.CHM(o),t.oxw().onCheckout()}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA(),t.TgZ(6,"app-toggle",2),t.NdJ("changed",function(a){const l=t.CHM(o).ngIf;return t.oxw().onToggleChanged(l,a)})("sortChanged",function(a){const l=t.CHM(o).ngIf;return t.oxw().onSortChanged(l,a)}),t.TgZ(7,"app-button",3),t._uU(8,"\xab\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435\xbb"),t.qZA(),t.TgZ(9,"app-button",4),t._uU(10,"\xab\u0412 \u043d\u0430\u043b\u0438\u0447\u0438\u0438\xbb"),t.qZA(),t.TgZ(11,"app-button",5),t._uU(12,"\xab\u0421\u043e \u0441\u043a\u0438\u0434\u043a\u043e\u0439\xbb"),t.qZA()(),t.TgZ(13,"input",6),t.NdJ("keyup",function(a){const l=t.CHM(o).ngIf;return t.oxw().onSearch(l,a)}),t.qZA(),t.TgZ(14,"div",7),t.YNc(15,Rt,4,3,"ng-template",8),t.ALo(16,"async"),t.YNc(17,Qt,1,0,null,0),t.ALo(18,"async"),t.qZA(),t.TgZ(19,"div",7),t.YNc(20,bt,2,0,"app-button",9),t.ALo(21,"async"),t.qZA(),t.BQk()}if(2&e){const o=r.ngIf,n=t.oxw();t.xp6(1),t.Q6J("ngIf",t.lcZ(2,7,n.loading$)),t.xp6(2),t.Q6J("products",t.lcZ(4,9,n.inCart$))("total",t.lcZ(5,11,n.total$)),t.xp6(3),t.Q6J("sort",o.sort),t.xp6(9),t.Q6J("ngForOf",t.lcZ(16,13,n.products$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(18,15,n.products$)),t.xp6(3),t.Q6J("ngIf",t.lcZ(21,17,n.next$))}}let Xt=(()=>{class e{constructor(o,n,a,c,l){this.route=o,this.router=n,this.catalogService=a,this.cartService=c,this.store=l,this.products$=this.store.pipe((0,i.Ys)(ct)),this.filter$=this.store.pipe((0,i.Ys)(it)),this.loading$=this.store.pipe((0,i.Ys)(st)),this.next$=this.store.pipe((0,i.Ys)(ut)),this.inCart$=this.store.pipe((0,i.Ys)(pt)),this.total$=this.store.pipe((0,i.Ys)(dt)),this.term$=new h.x,this.destroy$=new h.x,this.route.queryParams.subscribe(p=>{let C={...E,toggle:At(p.toggle),sort:p.sort||"Default"};this.loadCatalog(C.filter),this.term$.pipe(function rt(e,r=nt){return(0,w.e)((o,n)=>{let a=null,c=null,l=null;const p=()=>{if(a){a.unsubscribe(),a=null;const g=c;c=null,n.next(g)}};function C(){const g=l+e,z=r.now();if(z<g)return a=this.schedule(void 0,g-z),void n.add(a);p()}o.subscribe((0,k.x)(n,g=>{c=g,l=r.now(),a||(a=r.schedule(C,e),n.add(a))},()=>{p(),n.complete()},void 0,()=>{c=a=null}))})}(3e3)).pipe((0,at.x)()).pipe(A(this.destroy$)).subscribe(g=>this.loadCatalog(g))})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}onSearch(o,n){this.term$.next({...o,page:1,term:n.target.value})}onAddToCart(o){this.store.dispatch(U({product:o}))}onRemoveFromCart(o){this.store.dispatch(D({product:o}))}onClearCart(){this.store.dispatch(L())}onCheckout(){this.cartService.checkout(),this.router.navigate(["order"])}onToggleChanged(o,n){this.loadCatalog({...o,page:1,toggle:n})}onSortChanged(o,n){this.loadCatalog({...o,page:1,sort:n})}onLoad(o){this.loadCatalog({...o,page:o.page+1})}onRate(o,n){n.rate=o}loadCatalog(o){this.store.dispatch(x({filter:o}))}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(d.gz),t.Y36(d.F0),t.Y36(v.a),t.Y36(Ft.N),t.Y36(i.yh))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-catalog"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"products","total","removeFromCart","clearCart","checkout"],[3,"sort","changed","sortChanged"],["data","ShowAll",1,"toggle"],["data","InStock",1,"toggle"],["data","HasDiscount",1,"toggle"],["placeholder","\u043f\u043e\u0438\u0441\u043a",1,"search","button",3,"keyup"],[1,"center"],["ngFor","",3,"ngForOf"],["color","primary",3,"click",4,"ngIf"],[3,"product"],[3,"isDisabled","click"],["color","primary",3,"click"]],template:function(o,n){1&o&&(t.YNc(0,jt,22,19,"ng-container",0),t.ALo(1,"async")),2&o&&t.Q6J("ngIf",t.lcZ(1,1,n.filter$))},directives:[u.O5,kt,Et,Z,u.sg,P,Ht],pipes:[u.Ov],encapsulation:2,changeDetection:0}),e})();const qt=[{path:"",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-catalogpage"]],features:[t._Bn([])],decls:1,vars:0,template:function(o,n){1&o&&t._UZ(0,"app-catalog")},directives:[Xt],encapsulation:2}),e})()},{path:":id",component:tt}];let Kt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.ez,d.Bz.forChild(qt)],d.Bz]}),e})(),Gt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.ez]]}),e})();var Y=s(4466);let Vt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz,u.ez,Gt,Y.m]]}),e})();class f{constructor(){this.items=f.load()}static load(){const r=localStorage.getItem("cart");let o=[];return r&&(o=JSON.parse(r)),o}static save(r){localStorage.setItem("cart",JSON.stringify(r))}}const Wt={items:f.load()},te=(0,i.Lq)(Wt,(0,i.on)(U,(e,{product:r})=>{let o={items:e.items.filter(c=>c.product.id!=r.id)},n=e.items.findIndex(c=>c.product.id===r.id),a=n>-1?e.items[n]?.count??0:0;return o.items.splice(n,0,{count:++a,product:r}),f.save(o.items),o}),(0,i.on)(D,(e,{product:r})=>{let o={items:e.items.filter(n=>n.product.id!=r.id)};return f.save(o.items),o}),(0,i.on)(L,()=>{let e={items:[]};return f.save(e.items),e}));var y=s(2655),ee=s(262),oe=s(9646);let ne=(()=>{class e{constructor(o,n){this.action$=o,this.catalogService=n,this.loadProducts$=(0,y.GW)(()=>this.action$.pipe((0,y.l4)(x),(0,H.z)(a=>this.catalogService.find(a.filter).pipe((0,_.U)(c=>J({products:c}),(0,ee.K)(c=>(0,oe.of)(M({error:c}))))))))}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(y.eX),t.LFG(v.a))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),S=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.ez]]}),e})(),re=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[S,u.ez]]}),e})(),ae=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[R],imports:[[u.ez]]}),e})(),ce=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.ez,S]]}),e})(),ie=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[v.a],imports:[[u.ez,Kt,re,Y.m,ce,Vt,S,ae,i.Aw.forFeature("catalog",lt),i.Aw.forFeature("cart",te),y.sQ.forFeature([ne])]]}),e})()}}]);